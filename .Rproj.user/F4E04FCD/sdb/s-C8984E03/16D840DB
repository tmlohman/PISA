{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Untitled\"\nauthor: \"Tegan Lohman\"\ndate: \"August 29, 2016\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(gridExtra)\n\ngetwd()\n\n```\n\n\n\n```{r}\n\n# Load data, clean up table, check types\npisadata <- read.table('sample2.csv', header = TRUE, sep = \",\")\npisadict <- read.csv('pisadict2012.csv', header = FALSE)\n\nncol(pisadata)\nnrow(pisadict)\n\nheader <- t(pisadict)[1,]\nnames(pisadata) <- header\n\nsummary(pisadata)\nView(pisadata[502:506])\n\nstr(pisadata)\n```\n\n```{r}\n\ncolnames(pisadata)[colnames(pisadata)==\"Country code 3-character\"] <- \"Country\"\n\ncountry_groups <- group_by(pisadata, Country)\n\nggplot(data = country_groups, aes(factor(Country))) +\n  geom_bar() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\n```\nMost countries have about 50 students represented in this sample, however a few are heavily over or under-represented. The United States is represented, as are several individual states. I wonder if all states have individual data in the complete data set.\n```{r}\navg_scores_by_country <- aggregate(pisadata[, c(502, 542, 547)],\n                                   list(pisadata$Country), mean)\nnames(avg_scores_by_country) <- c('country', 'math', 'reading', 'science')\nggplot(avg_scores_by_country, ) +\n  geom_point(aes(country, math), color = 'blue') +\n  geom_point(aes(country, reading), color = 'red') +\n  geom_point(aes(country, science), color = 'green') +\n  the?me(axis.text.x = element_text(angle = 90, hjust = 1))\n```\nThe scores for math, reading, and science tend to fall within a narrow range by country. In other words, countries tend to either do well in everything, or poorly in everything.\n```{r}\nscores_and_ses <- read.csv('selected_columns_sample.csv', colClasses = c('factor', 'numeric', 'numeric', 'numeric', 'numeric'))\n\nView(scores_and_ses$escs)\n\nggplot(scores_and_ses) +\n  geom_point(aes(escs, math), color = 'blue', alpha = 0.2) +\n   geom_point(aes(escs, reading), color = 'red', alpha = 0.2) +\n   geom_point(aes(escs, science), color = 'green', alpha = 0.2) \n\n```\nInternationally, students from families who are better off financially score better on the math, reading, and science assessments. Does this correlation vary by country?\n```{r}\nUnited_States <- subset(scores_and_ses, country == 'United States of America')\nChina <- subset(scores_and_ses, country == 'Macao-China')\nGermany <- subset(scores_and_ses, country == 'Germany')\nBrazil <- subset(scores_and_ses, country == 'Brazil')\n\np1 <- ggplot(United_States) +\n  geom_point(aes(escs, math), color = 'blue', alpha = 0.2) +\n  geom_point(aes(escs, reading), color = 'red', alpha = 0.2) +\n  geom_point(aes(escs, science), color = 'green', alpha = 0.2) +\n  ggtitle(\"United States\")\n\np2 <- ggplot(Brazil) +\n  geom_point(aes(escs, math), color = 'blue', alpha = 0.2) +\n  geom_point(aes(escs, reading), color = 'red', alpha = 0.2) +\n  geom_point(aes(escs, science), color = 'green', alpha = 0.2) +\n  ggtitle(\"Brazil\")\n\np3 <- ggplot(China) +\n  geom_point(aes(escs, math), color = 'blue', alpha = 0.2) +\n  geom_point(aes(escs, reading), color = 'red', alpha = 0.2) +\n  geom_point(aes(escs, science), color = 'green', alpha = 0.2) +\n  ggtitle(\"China\")\n\np4 <- ggplot(Germany) +\n  geom_point(aes(escs, math), color = 'blue', alpha = 0.2) +\n  geom_point(aes(escs, reading), color = 'red', alpha = 0.2) +\n  geom_point(aes(escs, science), color = 'green', alpha = 0.2) +\n  ggtitle(\"Germany\")\n\ngrid.arrange(p1, p2, p3, p4, ncol = 2)\n\n```\nThe link between socio-economic status and test scores varies by country.\n\n```{r}\n\nscores_and_ses_complete <- read.csv('selected_columns_complete.csv', header = TRUE, colClasses = c('factor', 'numeric', 'numeric', 'numeric', 'numeric'))\n\navg_scores_by_country_complete <- aggregate(scores_and_ses_complete[, \n                                                                c(2, 3,4,5), ],\n                                   list(scores_and_ses_complete$country), mean,\n                                   na.rm = TRUE)\n\nnames(avg_scores_by_country_complete) <- c('country', 'escs', 'math_avg', 'reading_avg', 'science_avg')\n\nwrite.table(avg_scores_by_country_complete, \n            file = \"avg_scores_by_country_complete.csv\",\n            sep = \",\")\n\n```\n\n```{r}\n\n\nggplot(data = avg_scores_by_country_complete, aes(factor(country), math_avg)) +\n  geom_bar(stat = 'identity') +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\nggplot(data = avg_scores_by_country_complete, aes(escs, math_avg)) +\n  geom_point()\n\n```\n```{r}\nUnited_States_complete <- subset(scores_and_ses_complete, \n                                 country == 'United States of America')\n\nggplot(United_States_complete) +\n  geom_point(aes(escs, math), color = 'blue', alpha = 0.1) +\n  ggtitle(\"United States\")\n\nCanada_complete <- subset(scores_and_ses_complete, \n                                 country == 'Canada')\n\nggplot(Canada_complete) +\n  geom_point(aes(escs, math), color = 'blue', alpha = 0.1) +\n  ggtitle(\"Canada\")\n\nx = Canada_complete$escs\ny = Canada_complete$math\ncor(x,y, use = 'complete.obs')\ncor(United_States_complete$escs, United_States_complete$math, use = 'complete.obs')\n\n```\n\n```{r}\n\nx <- quantile(United_States_complete$escs, prob = seq(0, 1, length = 5), na.rm =TRUE)\nUS1 <- mean(subset(United_States_complete, United_States_complete$escs <= x[1])$math)\nUS2 <- mean(subset(United_States_complete, United_States_complete$escs <= x[2] &\n                United_States_complete$escs > x[1])$math)\nUS3 <- mean(subset(United_States_complete, United_States_complete$escs <= x[3] &\n                United_States_complete$escs > x[2])$math)\nUS4 <- mean(subset(United_States_complete, United_States_complete$escs <= x[4] &\n                United_States_complete$escs > x[3])$math)\nUS5 <- mean(subset(United_States_complete, United_States_complete$escs > x[4])$math)\ny = c(US1, US2, US3, US4, US5)\ndf <- data_frame(x,y)\n\nggplot(df, aes(x,y)) +\n  geom_point() +\n  xlab(\"ESCS by quintile\") +\n  ylab(\"average math score\") +\n  ggtitle(\"United States\")\n\nwrite.table(df, \n            file = \"US_quantiles.csv\",\n            sep = \",\")\n```\n\n```{r}\ncountry_groups <- group_by(scores_and_ses_complete, country)\ncountries <- unique(scores_and_ses_complete$country)\n```\n\n\n```{r}\n\n\n\nquintiles <- data.frame(country = character(),\n                 quintile = numeric(),\n                 escs = numeric(),\n                 math = numeric(),\n                 reading = numeric(),\n                 science = numeric(),\n                 stringsAsFactors = FALSE)\nfor (c in countries)\n{\n  data <- subset(scores_and_ses_complete, country == c)\n  quint <-  quantile(data$escs, prob = seq(0, 1, length = 6), na.rm =TRUE)\n  Q0 <- subset(data, escs <= quint[1])\n  row <- data.frame(c, 0.0, quint[[1]], median(Q0$math, na.rm =TRUE), \n           median(Q0$reading, na.rm =TRUE),\n           median(Q0$science, na.rm =TRUE))\n  names(row) <- c('country', 'prob', 'escs', 'math', 'reading', 'science')\n  #quintiles <- rbind(quintiles, row)\n  Q1 <- subset(data, data$escs <= quint[2])\n    row <- data.frame(c, 0.2, quint[[2]], median(Q1$math, na.rm =TRUE), \n           median(Q1$reading, na.rm =TRUE),\n           median(Q1$science, na.rm =TRUE))\n  names(row) <- c('country', 'prob', 'escs', 'math', 'reading', 'science')\n  quintiles <- rbind(quintiles, row)\n  Q2 <- subset(data, data$escs <= quint[3] & data$escs > quint[2])\n    row <- data.frame(c, 0.4, quint[[3]], median(Q2$math, na.rm =TRUE), \n           median(Q2$reading, na.rm =TRUE),\n           median(Q2$science, na.rm =TRUE))\n    names(row) <- c('country', 'prob', 'escs', 'math', 'reading', 'science')\n    quintiles <- rbind(quintiles, row)\n  Q3 <- subset(data, data$escs <= quint[4] & data$escs > quint[3])\n    row <- data.frame(c, 0.6, quint[[4]], median(Q3$math, na.rm =TRUE), \n           median(Q3$reading, na.rm =TRUE),\n           median(Q3$science, na.rm =TRUE))\n    names(row) <- c('country', 'prob', 'escs', 'math', 'reading', 'science')\n    quintiles <- rbind(quintiles, row)\n  Q4 <- subset(data, data$escs <= quint[5] & data$escs > quint[4])\n    row <- data.frame(c, 0.8, quint[[5]], median(Q4$math, na.rm =TRUE), \n           median(Q4$reading, na.rm =TRUE),\n           median(Q4$science, na.rm =TRUE))\n    names(row) <- c('country', 'prob', 'escs', 'math', 'reading', 'science')\n    quintiles <- rbind(quintiles, row)\n  Q5 <- subset(data, data$escs > quint[5])\n    row <- data.frame(c, 1.0, quint[[6]], median(Q5$math, na.rm =TRUE), \n           median(Q5$reading, na.rm =TRUE),\n           median(Q5$science, na.rm =TRUE))\n    names(row) <- c('country', 'prob', 'escs', 'math', 'reading', 'science')\n    quintiles <- rbind(quintiles, row)\n\n}\n\n\n\n```\n\n```{r}\nwrite.table(quintiles, \n            file = \"quintiles.csv\",\n            sep = \",\")\n\n```\n```{r}\n\nggplot(data = subset(quintiles, country == \"United States of America\"), aes(escs, math)) +\n  geom_point()\n\nunique(quintiles$country)\n```\n\n",
    "created" : 1472532400086.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1629066090",
    "id" : "16D840DB",
    "lastKnownWriteTime" : 1473273348,
    "last_content_update" : 1473273348660,
    "path" : "~/Projects/P6/PISA/eda.Rmd",
    "project_path" : "eda.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}