<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
</head>
<body>
  <script type="text/javascript">  
  
  // figure settings
  var margin = 40
  width = 800 - margin
  height = 600 - margin
	
  var svg = d3.select("body")
			  .append("svg")
			  .attr("width", width + margin)
			  .attr("height", height + margin)
			  .append('g')
			  .attr('class', 'chart');
  
  // draw function for initial chart
  function draw(data) {
	// get the data
	data.map(function (d) {
							d.group = d.group;
							d.xscore = +d.xscore;
							d.yscore = +d.yscore;
	});
	
	// axis settings
    var x_extent = d3.extent(data, function(d) { return d['xscore']; });
    x_extent[0] -= 3;
    x_extent[1] += 3;
	var x_scale = d3.scale.linear()
			              .range([margin, width])
		                  .domain(x_extent);
	var x_axis = d3.svg.axis()
	                   .scale(x_scale);
		  
	var y_extent = d3.extent(data, function(d) { return d['yscore']; });
	y_extent[0] -= 3;
    y_extent[1] += 3;
    var y_scale = d3.scale.linear()
			              .range([height, margin])
			              .domain(y_extent);
	var y_axis = d3.svg.axis()
			           .scale(y_scale)
		      	       .orient("left");
			
    // add axes
	d3.select("svg")
	  .append('g')
	  .attr('class', 'x axis')
	  .attr('transform', "translate(0," + height + ")")
	  .call(x_axis);
    
    d3.select("svg")
	  .append('g')
	  .attr('class', 'y axis')
	  .attr('transform', "translate(" + margin + ",0)")
	  .call(y_axis);
	
	
	// plot them circles
	d3.select('svg')
	  .selectAll('circle')
	  .data(data, function (d) { return d.group; })
	  .enter()
	  .append('circle')
	  .attr("id", function(d) { return d.group })
	  .attr('cx', function(d) {
                  return x_scale(d.xscore);
                  })
      .attr('cy', function(d) {
                  return y_scale(d.yscore);
                  })
      .attr('r', 7)
      .attr('fill', 'black')
      .on('mouseover', function() {d3.select(this).attr('fill', 'blue')})
      .on('mouseout', function() {d3.select(this).attr('fill', 'black')})
      .on('click', draw_individuals);

  } // end draw() function
  
  // on-click function for drawing individual points when group point is selected
  function draw_individuals(d, i) {
    
    group = d3.select(this).attr('id')
    console.log(group)

    
    // hardcoded scaling info
    var x_scale = d3.scale.linear()
			              .range([margin, width])
		                  .domain([5, 17]);
	var y_scale = d3.scale.linear()
			              .range([height, margin])
			              .domain([5, 17]);
    
    function new_draw(data) {
    
      // select matching data
      var data_upd = d3.select('svg')
                       .selectAll('circle')
                       .data(data.filter( function(d) { return d['group'].slice(0,-1) == group} ), 
                             function(d) { 
								 //console.log(d.group);
								 return d.group; });
      data_ent = data_upd.enter();

      	
      // old circles, removed
      data_upd.remove();
	
      // new circles, added
  	  data_ent.append('circle')
  	    .attr("id", function(d) { return d.group })
	    .attr('cx', function(d) {
                    return x_scale(d.xscore);
                    })
        .attr('cy', function(d) {
                    return y_scale(d.yscore);
                    })
        .attr('r', 5)
        .attr('fill', 'red');
        
    } // end new_draw() function
    
    d3.csv("individual_scores.csv", new_draw);
    
  } // end draw_individuals() function
  
  // plot the initial points
  d3.csv("group_scores.csv", draw)
  
  </script>
</body>
</html>
